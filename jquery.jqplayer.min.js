/**!

	jQPlayer - HTML 5 Video Player Plugin for jQuery
	Version: 0.5
	Site: http://jqplayer.vebersol.net/
	
	Author: Vin√≠cius Ebersol
	Designer: Thiago Reis
	
	License: MIT License
	
*/
var options;(function(a){var b=function(c,d){this.selector=c;this.options=d;this.idCounter=0;this.playing=false;this.supportHTML5=true;this.posterVisible=false;this.init();};b.prototype={init:function(){var f=document.createElement("video");if(f.canPlayType){this.supportHTML5=true;return this.start();}else{this.supportHTML5=false;var c=false;try{var d=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(d){c=true;}}catch(g){if(navigator.mimeTypes["application/x-shockwave-flash"]!=undefined){c=true;}}if(c){this.startFallback();}}},start:function(){this.getDefaultVideo();this.createVideoElement();this.createControls();this.bindControls();this.bindEvents();this.setupSubtitles();if(this.options.onStart){this.options.onStart.call();}},startFallback:function(){var c=this;this.supportHTML5=false;this.getDefaultVideo();this.createFlashElement();this.createControls();this.bindControls();this.bindEvents();this.setupSubtitles();if(this.options.onStart){this.options.onStart.call();}},adjustSubtitle:function(d){this.subtitleObj.count=0;this.subtitleObj.current=this.subtitleObj.content[this.subtitleObj.count];var e=this.supportHTML5?d.currentTime:d.currentTime(),c=parseFloat(e);while(this.getMaxTime()<c){this.updateSubtitle(d);if(this.subtitleObj.count>this.subtitleObj.content.length-1){this.subtitleObj.count=this.subtitleObj.content.length-1;break;}}},bindControls:function(){var d=this;for(var c=0;c<this.options.controls.length;c++){switch(this.options.controls[c]){case"play":this.selector.find(d.getClass("play")).bind("click",function(){d.playPause();});break;case"progress":this.setupProgressBar();break;case"volume":this.selector.find(d.getClass("volume-button")).bind("click",function(){d.muteVideo();});break;case"fullscreen":this.selector.find(d.getClass("fullscreen")).bind("click",function(){d.toFullscreen();});break;default:break;}}},bindEvents:function(){var f=this;var d=this.video.get(0);if(this.supportHTML5){d.addEventListener("loadedmetadata",function(){f.eventsToBind();},true);if(a.browser.webkit){a(document).bind("webkitfullscreenchange",function(){f.fullscreenEvent();});}else{if(a.browser.mozilla){a(document).bind("mozfullscreenchange",function(){f.fullscreenEvent();});}}}else{a(document).bind("flash.loaded",function(){f.eventsToBind();});}var e=function(){a(this).addClass("hover");};var c=function(){var g=a(this);if(g.hasClass(f.getClass("volume").replace(".",""))&&f.volumeFlag){return false;}g.removeClass("hover");};a(this.getClass("play")).hover(e,c);a(this.getClass("volume")).hover(e,c);a(this.getClass("fullscreen")).hover(e,c);a(this.getClass("alternative-versions")).hover(e,c);this.selector.bind("mouseleave",function(g){g.preventDefault();if(f.playing){clearTimeout(f.inactivateTimer);f.inactivateTimer=setTimeout(function(){f.selector.find(f.getClass("video-controls")).addClass("inactive");},2000);}});this.selector.bind("mouseenter",function(g){g.preventDefault();clearTimeout(f.inactivateTimer);f.selector.find(f.getClass("video-controls")).removeClass("inactive");});this.selector.find(this.getClass("video-controls")).bind("mousedown",function(g){g.preventDefault();});a(window).bind("resize",function(){f.setupProgressBar();});},blockSelection:function(){this.volumeFlag=true;document.onselectstart=function(){return false;};},changeVideoSource:function(e){var i=a(e).parent().parent().parent();currentVersion=i.attr("class").replace(this.setClass("alternative-versions")+" ","");var c=i.find(this.getClass("current-version"));var d=a(e).parent().attr("class").replace("."+this.options.prefix+"alternative-","");if(currentVersion!=d){var h=this.options.videos[d];c.html(h.label);c.parent().removeClass(currentVersion).addClass(d);video=this.video.get(0);if(this.supportHTML5){video.pause();}else{video._pause();}this.resetVideo();if(this.supportHTML5){video.src=this.getVideoSource(h);}else{video.changeVideo(this.getVideoSource(h));}var g=a(this.getClass("alternative-versions")).find("ul");g.html("");for(d in this.options.videos){var k=this.options.videos[d];if(k!=h){if(k.source){var j=a('<li class="'+this.getClass("alternative-"+d)+'"><a href="javascript:;"><span></span></a></li>');if(k.label){j.find("span").html(k.label);}var f=this;j.find("a").bind("click",function(){f.changeVideoSource(this);});g.append(j);}}}var f=this;if(this.supportHTML5){video.addEventListener("loadedmetadata",function(){this.play();if(f.options.onVideoChange){f.options.onVideoChange.call();}},true);}}},createAlternative:function(){var d=a('<div class="'+this.setClass("alternative-versions")+'"></div>');d.append('<span class="'+this.setClass("current-version")+'">'+this.defaultVideo.label+"</span>");d.append("<ul></ul>");for(alternative in this.options.videos){var e=this.options.videos[alternative];if(e!=this.defaultVideo){if(e.source){var c=a('<li class="'+this.getClass("alternative-"+alternative)+'"><a href="javascript:;"><span></span></a></li>');if(e.label){c.find("span").html(e.label);}var f=this;c.find("a").bind("click",function(){f.changeVideoSource(this);});d.find("ul").append(c);}}else{d.addClass(alternative);}}return d;},createButton:function(c,f){var e=a("<div>").addClass(this.setClass(f));var d=a("<span>").html(c);e.append(d);return e;},createClearFloats:function(){return'<div style="clear:both;width:0;height:0;margin:0;padding:0;"><!-- --></div>';},createControls:function(){this.controls=a("<div>").addClass(this.setClass(this.options.controlsClass));for(var h=0;h<this.options.controls.length;h++){switch(this.options.controls[h]){case"play":var c=this.createButton("Play/Pause","play");this.controls.append(c);break;case"progress":var k=this.createProgressBar();this.controls.append(k);break;case"time":var e=this.createTimeDisplay();this.controls.append(e);break;case"volume":var g=this.createVolumeBar();this.controls.append(g);break;case"fullscreen":if(a.browser.webkit||a.browser.mozilla){var j=this.createButton("Fullscreen","fullscreen");this.controls.append(j);}break;case"alternative":var f=this.createAlternative();this.controls.append(f);break;default:var d=this.createCustomButton(this.options.controls[h]);this.controls.append(d);break;}}this.controls.append(this.createClearFloats());this.selector.append(this.controls);},createCustomButton:function(d){var e=null;var c=this.options.customButtons[d];if(c){if(c.url){e=a('<div><a href="'+c.url+'"></a></div>');if(c.label){e.find("a").html(c.label);}if(c.className){e.addClass(c.className);}if(c.target){e.find("a").attr("target",c.target);}}else{if(c.onclick){e=a('<div><a href="javascript:;"></a></div>');e.find("a").bind("click",c.onclick);if(c.className){e.addClass(c.className);}if(c.label){e.find("a").html(c.label);}}}e.addClass(this.setClass("custom-button"));return e;}return false;},createFlashElement:function(){this.createPoster();var g={"allowScriptAccess":"always","movie":this.options.fallbackOptions.swf,"allowNetworking":"all","wmode":"transparent","bgcolor":"#000000"};var d={"video":this.getVideoSource()};var e="",c=this.setClass("fallback")+"_"+Math.floor(Math.random()*999);if(a.browser.msie){e=' id="'+c+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"';}var f='<object type="application/x-shockwave-flash" width="100%" height="100%" data="'+this.options.fallbackOptions.swf+'" '+e+">";f+=this.addParams(g,d);f+="</object>";this.video=a(f);a(this.selector).append(this.video);},addParams:function(h,d){var c=[],e=[],j="<embed ";for(var g in d){e.push(g+"="+d[g]);}h.flashvars=e.join("&");for(var f in h){c.push('<param name="'+f+'" value="'+h[f]+'">');j+=f+'="'+h[f]+'" ';}j+=">";return c.join(" ")+j;},createPoster:function(){if(this.defaultVideo.poster){var c=a('<img src="'+this.defaultVideo.poster+'" class="'+this.setClass("poster")+'">');this.selector.append(c);this.posterVisible=true;}},createProgressBar:function(){var g=a("<div>").addClass(this.setClass("progress-bar"));var f=a("<div>").addClass(this.setClass("progress-wrapper"));var d=a("<div>").addClass(this.setClass("progress-play"));var e=a("<div>").addClass(this.setClass("progress-pointer"));var c=a("<div>").addClass(this.setClass("progress-buffer"));f.append(d);f.append(e);f.append(c);f.append(this.createClearFloats());g.append(f);return g;},createTimeDisplay:function(){var f=a("<div>").addClass(this.setClass("time-display"));var e=a("<div>").addClass(this.setClass("time-current"));var d=a("<div>").addClass(this.setClass("time-separator"));var c=a("<div>").addClass(this.setClass("time-total"));f.append(e);f.append(d);f.append(c);return f;},createVideoElement:function(){try{this.createPoster();this.video=a("<video>Your browser doesn't support video tag.</video>");this.video.attr("src",this.getVideoSource());this.video.width("100%");this.video.height("100%");if(this.defaultVideo.subtitle){this.video.append('<track src="'+this.defaultVideo.subtitle+'"></track>');}a(this.selector).append(this.video);}catch(c){this.supportHTML5=false;var d=a('<p class="'+this.setClass("error-message")+'"></p>').html("Your browser doesn't support html5 video. Try to setup a fallback in options.");a(this.selector).append(d);}},createVolumeBar:function(){var g=a("<div>").addClass(this.setClass("volume"));var d=a("<div>").addClass(this.setClass("volume-button")).html("Volume");var e=a("<div>").addClass(this.setClass("volume-bar"));var c=a("<div>").addClass(this.setClass("volume-icon-plus")).html("+");var i=a("<div>").addClass(this.setClass("volume-wrapper"));var h=a("<div>").addClass(this.setClass("volume-position"));var f=a("<div>").addClass(this.setClass("volume-icon-less")).html("-");i.append(h);e.append(c);e.append(i);e.append(f);g.append(d);g.append(e);return g;},eventsToBind:function(){if(a.inArray("progress",this.options.controls)){this.setProgressEvents(this.video.get(0));}if(a.inArray("time",this.options.controls)){this.setupTime();}if(a.inArray("volume",this.options.controls)){this.volumeSetup();}},findPosX:function(c){c=c.get(0);var d=c.offsetLeft;while(c=c.offsetParent){d+=c.offsetLeft;}return d;},findPosY:function(d){d=d.get(0);var c=d.offsetTop;while(d=d.offsetParent){c+=d.offsetTop;}return c;},formatTime:function(d){var c=Math.floor(d/60);var e=Math.round(d-(c*60));if(e==60){e=0;c=c+1;}if(e<10){e="0"+e;}return c+":"+e;},fullscreenEvent:function(){var c=a(this.getClass("fullscreen"));c.toggleClass("fullscreen");if(!this.fullscreen){this.selector.addClass("fullscreen");c.removeClass("hover");this.fullscreen=true;}else{this.selector.removeClass("fullscreen");c.removeClass("hover");this.fullscreen=false;}this.setupProgressBar();},getClass:function(c){return"."+this.options.prefix+c;},getControlsSize:function(){var c=0;var d=this;this.selector.find(this.getClass("video-controls")).children().each(function(){var e=a(this);if(!e.hasClass(d.setClass("progress-bar"))){c+=e.outerWidth();}});return c;},getDefaultVideo:function(){if(this.options.videos[this.options.defaultVideo]){this.defaultVideo=this.options.videos[this.options.defaultVideo];return this.defaultVideo;}for(var c in this.options.videos){this.defaultVideo=this.options.videos[c];return this.defaultVideo;}},getMaxTime:function(){if(typeof(this.subtitleObj.current)!="undefined"){var c=this.subtitleObj.current[1].split(" --> ");return this.timecodeToSec(c[1]);}},getMinTime:function(){if(typeof(this.subtitleObj.current)!="undefined"){var c=this.subtitleObj.current[1].split(" --> ");return this.timecodeToSec(c[0]);}},getSubtitle:function(){return this.defaultVideo.subtitle;},getVideoSource:function(c){if(!c){c=this.defaultVideo;}if(this.supportHTML5&&((a.browser.safari&&/Chrome[\/\s](\d+\.\d+)/.test(navigator.userAgent))||a.browser.msie)){return c.source.mp4;}else{if(!this.supportHTML5){return this.options.fallbackOptions.relativePath+c.source.mp4;}}if(c.source.ogg){return c.source.ogg;}return c.source.webm;},hideControls:function(c){c.animate({bottom:"-"+c.height()+"px"});},hidePoster:function(){this.selector.find(this.getClass("poster")).hide();this.posterVisible=false;},incrementId:function(){var c=this.options.videoId+this.idCounter;this.idCounter++;return c;},muteVideo:function(){var e=this.selector.find(this.getClass("volume-button"));var d=this.selector.find(this.getClass("volume-position"));var c=this.video.get(0);if(this.supportHTML5){if(c.muted){c.muted=false;e.removeClass("muted");d.height(c.volume*100+"%");}else{c.muted=true;e.addClass("muted");d.height(0);}}else{if(this.flashMuted){this.flashMuted=false;c.volume(this.flashVolume);e.removeClass("muted");d.height(this.flashVolume*100+"%");}else{this.flashMuted=true;this.flashVolume=c.getVolume();c.volume(0);e.addClass("muted");d.height(0);}}},pauseEvent:function(c){a(c).parent().find(this.getClass("play")).removeClass("playing").addClass("paused");if(this.options.onPause){this.options.onPause.call();}this.playing=false;},playEvent:function(d){var e=this;var c=a(this.getClass("progress-buffer"));this.bufferInterval=setInterval(function(){e.updateBuffer(d,c);},1000);a(d).parent().find(this.getClass("play")).removeClass("paused").addClass("playing");this.seekVideoSetup(d);if(this.options.onPlay){this.options.onPlay.call();}this.playing=true;},playPause:function(){var c=this.video.get(0);if(this.supportHTML5){if(c.paused){c.play();}else{c.pause();}}else{if(c.paused()){c._play();}else{c._pause();}}},resetVideo:function(){this.controls.find(this.getClass("video-controls")+", "+this.getClass("progress-buffer")).css("width",0);clearInterval(this.bufferInterval);},seekTo:function(i,g,f){var h=a(this.getClass("progress-play"));var e=Math.max(0,Math.min(1,(i-this.findPosX(g))/g.width()));var d=e*(this.supportHTML5?f.duration:f.duration());if(this.supportHTML5){f.currentTime=d;}else{f.seekTo(d);}var c=Math.round(e*(g.width()));h.width(c);},seekVideoSetup:function(c){var d=a(c).parent().find(this.getClass("progress-wrapper"));if(d.length>0){this.selectable=true;var e=this;d.bind("mousedown",function(f){f.preventDefault();e.blockSelection();a(document).bind("mousemove",function(g){g.preventDefault();e.seekTo(g.pageX,d,c);});a(document).bind("mouseup",function(g){g.preventDefault();e.unblockSelection();a(document).unbind("mousemove");a(document).unbind("mouseup");});});d.bind("mouseup",function(f){e.seekTo(f.pageX,d,c);});}},setClass:function(c){return this.options.prefix+c;},setProgressEvents:function(f){var g=this;var e=a(this.getClass("progress-play"));var c=a(this.getClass("progress-buffer"));if(this.supportHTML5){f.addEventListener("seeked",function(){if(!f.paused){f.play();}if(g.subtitleObj&&g.subtitleObj.loaded){g.adjustSubtitle(this);}if(g.options.onSeek){g.options.onSeek.call();}},true);f.addEventListener("ended",function(){e.width("100%");clearInterval(g.progressInterval);this.currentTime=0;this.pause();if(g.options.onEnd){g.options.onEnd.call();}g.playing=false;},true);f.addEventListener("timeupdate",function(){g.updateVideoData(this,e);g.updateCurrentTime(this);if(g.subtitleObj&&g.subtitleObj.loaded){g.updateSubtitle(f);}},false);f.addEventListener("play",function(){if(g.posterVisible){g.hidePoster();}g.playEvent(this);},true);f.addEventListener("pause",function(){g.pauseEvent(this);},true);}else{var d=g.video.get(0);this.flashInterval=setInterval(function(){g.updateVideoData(d,e);g.updateCurrentTime(d);if(g.subtitleObj&&g.subtitleObj.loaded){g.updateSubtitle(d);}},500);a(document).bind("flash.play",function(){if(g.posterVisible){g.hidePoster();}g.playEvent(d);});a(document).bind("flash.pause",function(){g.pauseEvent(d);});a(document).bind("flash.seeked",function(){clearTimeout(g.seekTimeout);g.seekTimeout=setTimeout(function(){if(!d.paused()){d._play();}if(g.subtitleObj&&g.subtitleObj.loaded){g.adjustSubtitle(d);}if(g.options.onSeek){g.options.onSeek.call();}},200);});a(document).bind("flash.videoChanged",function(){d._play();if(g.subtitleObj&&g.subtitleObj.loaded){g.adjustSubtitle(d);}if(g.options.onVideoChange){g.options.onVideoChange.call();}});a(document).bind("flash.end",function(){if(g.options.onEnd){g.options.onEnd.call();}});}},setupProgressBar:function(){var e=this.selector.find(this.getClass("progress-bar"));var d=this.selector.width();var c=e.parent().width()-parseInt(this.getControlsSize());e.parent().width(d);e.width(c);},setupSubtitles:function(){var f=this;this.subtitleObj={};var e=this.defaultVideo.subtitle;if(e){a.ajax({url:e,success:function(g){f.subtitleObj.loaded=true;f.subtitlesToArray(g);f.subtitleObj.count=0;f.subtitleObj.current=f.subtitleObj.content[f.subtitleObj.count];}});var c=a('<div id="subtitle-'+this.selector.attr("id")+'" class="'+this.setClass("subtitle")+'"></div>');var d=a('<div class="'+this.setClass("subtitle-content")+'"></div>');c.append(d);this.subtitleObj.element=c;this.selector.append(this.subtitleObj.element);}},setupTime:function(){var d=this.selector.find(this.getClass("time-display")),c=d.find(this.getClass("time-total"));d.find(this.getClass("time-current")).html(this.formatTime(0));d.find(this.getClass("time-separator")).html(this.options.timeSeparator);if(this.supportHTML5){c.html(this.formatTime(this.video.get(0).duration));}else{var e=this;this.getDurationInterval=setInterval(function(){if(e.video.get(0).duration()>0){c.html(e.formatTime(e.video.get(0).duration()));clearInterval(e.getDurationInterval);}},10);}},subtitlesToArray:function(f){this.subtitleObj.content=[];var e=(f.search("\r\n")==-1)?"\n":"\r\n";var c=f.split(e+e);for(var d=0;d<c.length;d++){if(c[d].length>0){this.subtitleObj.content.push(c[d].split(e));}}},timecodeToSec:function(c){if(c){tc1=c.split(",");tc2=tc1[0].split(":");seconds=Math.floor(tc2[0]*60*60)+Math.floor(tc2[1]*60)+Math.floor(tc2[2]);return seconds;}},toFullscreen:function(){clearTimeout(this.fullscreenTimeout);var d=this;if(this.supportHTML5){if(!this.fullscreen){if(this.selector.get(0).webkitRequestFullScreen){this.selector.get(0).webkitRequestFullScreen();}else{if(this.selector.get(0).mozRequestFullScreen){this.selector.get(0).mozRequestFullScreen();}}}else{if(document.webkitCancelFullScreen){document.webkitCancelFullScreen();}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen();}}}}else{var c=this.video.get(0);if(!this.fullscreen){this.selector.addClass("fullscreen");a(this.getClass("fullscreen")).removeClass("hover");this.fullscreen=true;}else{this.selector.removeClass("fullscreen");a(this.getClass("fullscreen")).removeClass("hover");this.fullscreen=false;}setTimeout(function(){d.setupProgressBar();},100);}},unblockSelection:function(){this.volumeFlag=false;document.onselectstart=function(){return true;};},updateBuffer:function(f,c){var e;if(this.supportHTML5){if(f.buffered&&f.buffered.length>0){e=f.buffered.end(0)/f.duration;var d=(e*100)+"%";c.width(d);if(e==1){clearInterval(this.bufferInterval);}}else{c.width("100%");clearInterval(this.bufferInterval);}}else{e=f.getBuffer();var d=(e*100)+"%";c.width(d);if(e==1){clearInterval(this.bufferInterval);}}},updateCurrentTime:function(e){var d=this.supportHTML5?e.currentTime:e.currentTime();var c=a(e).parent().find(this.getClass("time-current"));c.html(this.formatTime(d));},updateSubtitle:function(d){var c=this.supportHTML5?d.currentTime:d.currentTime();if(c>this.getMinTime()&&c<this.getMaxTime()){this.subtitleObj.current=this.subtitleObj.content[this.subtitleObj.count];this.subtitleObj.subtitle=this.subtitleObj.current[2];}else{this.subtitleObj.subtitle="";}if(c>this.getMaxTime()){this.subtitleObj.count++;this.subtitleObj.current=this.subtitleObj.content[this.subtitleObj.count];}this.subtitleObj.element.find("div:first").html(this.subtitleObj.subtitle);},updateVideoData:function(e,d){var f=d.parent().find(this.getClass("progress-pointer"));var c=(this.supportHTML5?e.currentTime:e.currentTime())*100/(this.supportHTML5?e.duration:e.duration());d.width(c+"%");f.css("left",c+"%");},volumeSetup:function(){var c=this.video.get(0);var e=this.selector.find(this.getClass("volume-wrapper"));var d=a(this.getClass("volume"));var f=this;this.volumeFlag=false;e.bind("mousedown",function(g){g.preventDefault();f.blockSelection();a(document).bind("mousemove",function(h){h.preventDefault();f.volumeTo(h.pageY,e,c);});a(document).bind("mouseup",function(h){h.preventDefault();if(h.target.className.search("volume")<0){d.removeClass("hover");}f.unblockSelection();a(document).unbind("mousemove");a(document).unbind("mouseup");});});e.bind("mouseup",function(g){f.volumeTo(g.pageY,e,c);});},volumeTo:function(f,i,e){var c=a(this.getClass("volume-position"));var d=Math.max(0,Math.min(1,(f-i.offset().top)/i.height()));var g=(d-1)*-1;if(this.supportHTML5){e.volume=g;}else{e.volume(g);}c.height(g*100+"%");var h=a(this.getClass("volume-button"));if(g<=0){h.addClass("muted");}else{h.removeClass("muted");}}};a.fn.jQPlayer=function(c){var d={controls:["play","progress","time","volume","fullscreen","alternative"],controlsClass:"video-controls",customButtons:{},defaultVideo:"standard",floatControls:false,onEnd:false,onPause:false,onPlay:false,onSeek:false,onStart:false,onVideoChange:false,prefix:"html-player-",timeSeparator:"/",videoId:"video-",fallbackOptions:{relativePath:"../",swf:"media/jQPlayer.swf"}};var c=a.extend(d,c);return new b(this,c);};})(jQuery);